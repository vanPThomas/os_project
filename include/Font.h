#pragma once

#include "Oled.h"           // ← Font can now safely call Oled::cmd / data
#include <cstdint>
#include <cstring>

namespace Font {

    static constexpr uint8_t WIDTH = 6;

    using Glyph = uint8_t[WIDTH];

    constexpr Glyph space = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

    constexpr Glyph A     = {0x00, 0xfc, 0x26, 0x22, 0x26, 0xfc};
    constexpr Glyph B     = {0x00, 0xfe, 0x92, 0x92, 0x92, 0x6c};
    constexpr Glyph C     = {0x00, 0x7c, 0x82, 0x82, 0x82, 0x44};
    constexpr Glyph D     = {0x00, 0xfe, 0x82, 0x82, 0x82, 0x7c};
    constexpr Glyph E     = {0x00, 0xfe, 0x92, 0x92, 0x92, 0x92};
    constexpr Glyph F     = {0x00, 0xfe, 0x12, 0x12, 0x12, 0x12};
    constexpr Glyph G     = {0x00, 0x7c, 0xc6, 0x82, 0x92, 0xf4};
    constexpr Glyph H     = {0x00, 0xfe, 0x10, 0x10, 0x10, 0xfe};
    constexpr Glyph I     = {0x00, 0x00, 0x82, 0xfe, 0x82, 0x00};
    constexpr Glyph J     = {0x00, 0x60, 0x80, 0x82, 0x7e, 0x02};
    constexpr Glyph K     = {0x00, 0xfe, 0x10, 0x28, 0x44, 0x82};
    constexpr Glyph L     = {0x00, 0xfe, 0x80, 0x80, 0x80, 0x80};
    constexpr Glyph M     = {0x00, 0xfe, 0x04, 0x08, 0x04, 0xfe};
    constexpr Glyph N     = {0x00, 0xfe, 0x0c, 0x10, 0x60, 0xfe};
    constexpr Glyph O     = {0x00, 0x7c, 0x82, 0x82, 0x82, 0x7c};
    constexpr Glyph P     = {0x00, 0xfe, 0x12, 0x12, 0x12, 0x0c};
    constexpr Glyph Q     = {0x00, 0x7c, 0x82, 0xa2, 0x7c, 0x80};
    constexpr Glyph R     = {0x00, 0xfe, 0x12, 0x12, 0x32, 0xec};
    constexpr Glyph S     = {0x00, 0x4c, 0x92, 0x92, 0x92, 0x64};
    constexpr Glyph T     = {0x00, 0x02, 0x02, 0xfe, 0x02, 0x02};
    constexpr Glyph U     = {0x00, 0x7e, 0x80, 0x80, 0x80, 0x7e};
    constexpr Glyph V     = {0x00, 0x3e, 0x40, 0x80, 0x40, 0x3e};
    constexpr Glyph W     = {0x00, 0x7e, 0x80, 0x70, 0x80, 0x7e};
    constexpr Glyph X     = {0x00, 0xc6, 0x28, 0x10, 0x28, 0xc6};
    constexpr Glyph Y     = {0x00, 0x06, 0x08, 0xf0, 0x08, 0x06};
    constexpr Glyph Z     = {0x00, 0xc2, 0xa2, 0x92, 0x8a, 0x86};

// Punctuation & symbols (your original names kept for clarity)
    constexpr Glyph dot   = {0x00, 0x00, 0xc0, 0xc0, 0x00, 0x00};
    constexpr Glyph comma = {0x00, 0x00, 0x80, 0xe0, 0x00, 0x00};
    constexpr Glyph colon = {0x00, 0x00, 0xc6, 0xc6, 0x00, 0x00};
    constexpr Glyph semi  = {0x00, 0x00, 0x86, 0xe6, 0x00, 0x00};
    constexpr Glyph gt    = {0x00, 0x82, 0x44, 0x28, 0x10, 0x00};
    constexpr Glyph lt    = {0x00, 0x10, 0x28, 0x44, 0x82, 0x00};
    constexpr Glyph qm    = {0x00, 0x0c, 0x02, 0xa2, 0x12, 0x0c};
    constexpr Glyph excl  = {0x00, 0x00, 0xde, 0xde, 0x00, 0x00};
    constexpr Glyph sbl   = {0x00, 0x7c, 0xc6, 0x82, 0x00, 0x00};  // (
    constexpr Glyph sbr   = {0x00, 0x00, 0x00, 0x82, 0xc6, 0x7c};  // )
    constexpr Glyph fs    = {0x00, 0xc0, 0x20, 0x10, 0x08, 0x06};  // forwardslash
    constexpr Glyph bs    = {0x00, 0x06, 0x08, 0x10, 0x20, 0xc0};  // backslash
    constexpr Glyph minus = {0x00, 0x08, 0x08, 0x08, 0x08, 0x08}; // -
    constexpr Glyph at    = {0x00, 0x3e, 0x41, 0x55, 0x49, 0x3e}; // @
    constexpr Glyph hash  = {0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14}; // #
    constexpr Glyph smile = {0x00, 0x66, 0xc2, 0x80, 0xc6, 0x62};
    constexpr Glyph sad   = {0x00, 0xc6, 0x64, 0x20, 0x66, 0xc4};

    constexpr Glyph zero   = {0x00, 0x7c, 0xc2, 0xba, 0x86, 0x7c}; // 0
    constexpr Glyph one    = {0x00, 0x00, 0x84, 0xfe, 0xfe, 0x80}; // 1
    constexpr Glyph two    = {0x00, 0x84, 0xc2, 0xa2, 0x92, 0x8c}; // 2
    constexpr Glyph three  = {0x00, 0x44, 0x82, 0x92, 0x92, 0x7c}; // 3
    constexpr Glyph four   = {0x00, 0x30, 0x28, 0x24, 0xf2, 0x20}; // 4
    constexpr Glyph five   = {0x00, 0x4e, 0x8a, 0x8a, 0x8a, 0x72}; // 5
    constexpr Glyph six    = {0x00, 0x7c, 0x92, 0x92, 0x92, 0x64}; // 6
    constexpr Glyph seven  = {0x00, 0x06, 0xc2, 0x22, 0x12, 0x0c}; // 7
    constexpr Glyph eight  = {0x00, 0x6c, 0x92, 0x92, 0x92, 0x6c}; // 8
    constexpr Glyph nine   = {0x00, 0x0c, 0x92, 0x92, 0x92, 0x7c}; // 9

    constexpr Glyph missing = {0x00, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe}; // if missing

    // In Font.h (add this after your glyphs)

    static constexpr const Glyph* const lookup[128] = {
        // 0-31: control chars
        &missing, &missing, &missing, &missing, &missing, &missing, &missing, &missing,
        &missing, &missing, &missing, &missing, &missing, &missing, &missing, &missing,
        &missing, &missing, &missing, &missing, &missing, &missing, &missing, &missing,
        &missing, &missing, &missing, &missing, &missing, &missing, &missing, &missing,

        // 32 = space
        &space,

        // 33 = !
        &excl,

        // 34-43: " # $ % & ' ( ) * +
        &missing, &hash, &missing, &missing, &missing, &missing, &sbl, &sbr, &missing, &missing,

        // 44 = ,
        &comma,

        // 45 = -
        &minus,

        // 46 = .
        &dot,

        // 47 = /
        &fs,

        // 48-57 = 0-9
        &zero, &one, &two, &three, &four, &five, &six, &seven, &eight, &nine,

        // 58-64 = : ; < = > ? @
        &colon, &semi, &lt, &missing, &gt, &qm, &at,

        // 65-90 = A-Z
        &A, &B, &C, &D, &E, &F, &G, &H, &I, &J,
        &K, &L, &M, &N, &O, &P, &Q, &R, &S, &T,
        &U, &V, &W, &X, &Y, &Z,

        // 91-96 = [ \ ] ^ _ `
        &missing, &bs, &missing, &missing, &missing, &missing,

        // 97-122 = a-z (currently uppercase only → map to uppercase or add lowercase later)
        &A, &B, &C, &D, &E, &F, &G, &H, &I, &J,
        &K, &L, &M, &N, &O, &P, &Q, &R, &S, &T,
        &U, &V, &W, &X, &Y, &Z,

        // 123-126 = { | } ~
        &missing, &missing, &missing, &missing
    };
    
    static void draw(uint8_t char_col, uint8_t page, const Glyph& g) {
        uint8_t start_col = char_col * WIDTH + 2;   // SH1106 offset
        Oled::cmd(0xB0 + page);
        Oled::cmd(0x00 + (start_col & 0x0F));
        Oled::cmd(0x10 + (start_col >> 4));
        Oled::data(g, WIDTH);
    }

    // Optimized print – no memcpy, direct pointer
    static void print(uint8_t col, uint8_t page, const char* str) {
        while (*str && col < 21) {          // 128 / 6 ≈ 21 chars
            const Glyph* g = lookup[static_cast<uint8_t>(*str)];
            draw(col++, page, *g);
            ++str;
        }
    }
    static void center_print(uint8_t page, const char* str) {
        uint8_t len = 0;
        while (str[len]) ++len;
        uint8_t start_col = (21 - len) / 2;   // rough center (21 chars max)
        print(start_col, page, str);
    }
}